<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isometric Joystick Game</title>
    <style>
        body {
            background-color: #1e1e2c;
            margin: 0;
            overflow: hidden;
            font-family: 'Comic Sans MS', cursive, sans-serif; /* Whimsical font */
        }
        canvas {
            display: block;
            margin: auto;
            background: url('https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/Background.PNG') no-repeat center center;
            background-size: cover;
        }
        h1 {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            color: white;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <h1>The Garden of Eeden</h1> <!-- Game title -->
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Player sprite sheet
        const playerImage = new Image();
        playerImage.src = 'https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/Characters/Red.png';

        // Joystick sprite sheet
        const joystickImage = new Image();
        joystickImage.src = 'https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/Joystick.png';

        // Jump button sprite sheet (updated with the correct sprite sheet)
        const jumpButtonImage = new Image();
        jumpButtonImage.src = 'https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/X-button.png';

        // Player properties
        const player = {
            x: 400,
            y: 300,
            width: 16,
            height: 30,
            speed: 2, // Movement speed
            direction: 'down',
            frameX: 0,
            frameY: 0,
            walkingCycle: 0,
            animationCounter: 0,
            velocityY: 0, // Y velocity for jumping
            isJumping: false
        };

        // Joystick properties
        const joystick = {
            x: 100, // Initial position of the joystick
            y: canvas.height - 150,
            radius: 50,
            stickRadius: 20,
            maxDistance: 50, // Maximum distance the stick can move
            isMoving: false,
            stickX: 0,
            stickY: 0,
        };

        // Jump button properties
        const jumpButton = {
            x: canvas.width - 120,
            y: canvas.height - 120,
            width: 100,
            height: 100,
            isPressed: false
        };

        // Keyboard input flags
        const keys = {
            w: false,
            a: false,
            s: false,
            d: false
        };

        // Ensure all assets are loaded before starting the game
        let assetsLoaded = 0;

        function checkAssetsLoaded() {
            assetsLoaded++;
            if (assetsLoaded === 3) {
                gameLoop(); // Start the game loop once all assets are loaded
            }
        }

        joystickImage.onload = checkAssetsLoaded;
        playerImage.onload = checkAssetsLoaded;
        jumpButtonImage.onload = checkAssetsLoaded;

        // Draw the joystick and stick
        function drawJoystick() {
            // Draw the joystick base
            ctx.drawImage(joystickImage, 0, 0, 128, 128, joystick.x - joystick.radius, joystick.y - joystick.radius, joystick.radius * 2, joystick.radius * 2);

            // Draw the joystick stick
            ctx.beginPath();
            ctx.arc(joystick.x + joystick.stickX, joystick.y + joystick.stickY, joystick.stickRadius, 0, 2 * Math.PI);
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fill();
        }

        // Handle joystick movement
        function handleJoystickMovement(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const dx = mouseX - joystick.x;
            const dy = mouseY - joystick.y;
            const distance = Math.min(Math.sqrt(dx * dx + dy * dy), joystick.maxDistance);

            joystick.stickX = (dx / Math.sqrt(dx * dx + dy * dy)) * distance;
            joystick.stickY = (dy / Math.sqrt(dx * dx + dy * dy)) * distance;

            if (e.type === 'mousedown') {
                joystick.isMoving = true;
            } else if (e.type === 'mouseup') {
                joystick.isMoving = false;
                joystick.stickX = 0;
                joystick.stickY = 0;
            }
        }

        // Update player movement based on joystick direction
        function updatePlayerMovement() {
            const moveX = joystick.stickX / joystick.maxDistance;
            const moveY = joystick.stickY / joystick.maxDistance;

            player.x += moveX * player.speed;
            player.y += moveY * player.speed;
        }

        // Update player movement based on WASD keyboard input
        function updatePlayerMovementKeyboard() {
            if (keys.w) player.y -= player.speed;
            if (keys.s) player.y += player.speed;
            if (keys.a) player.x -= player.speed;
            if (keys.d) player.x += player.speed;
        }

        // Update jump
        function handleJump() {
            if (player.isJumping) {
                player.velocityY += 0.5; // Gravity
                player.y += player.velocityY;

                if (player.y >= 300) {
                    player.y = 300;
                    player.isJumping = false;
                    player.velocityY = 0;
                }
            }
        }

        // Draw the jump button
        function drawJumpButton() {
            ctx.drawImage(jumpButtonImage, jumpButton.x, jumpButton.y, jumpButton.width, jumpButton.height);
        }

        // Handle jump button click
        function handleJumpButton(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            if (
                mouseX >= jumpButton.x &&
                mouseX <= jumpButton.x + jumpButton.width &&
                mouseY >= jumpButton.y &&
                mouseY <= jumpButton.y + jumpButton.height
            ) {
                player.isJumping = true;
                player.velocityY = -8; // Initial jump speed
            }
        }

        // Draw the player character
        function drawPlayer() {
            const row = player.walkingCycle === 0 ? 1 : 3;
            ctx.drawImage(
                playerImage,
                player.frameX * player.width,
                row * 32 - 12, // Adjusted for 12px shift
                player.width,
                player.height,
                player.x,
                player.y,
                player.width,
                player.height
            );
        }

        // Game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the joystick
            drawJoystick();

            // Draw the jump button
            drawJumpButton();

            // Update player movement based on joystick or keyboard input
            if (joystick.isMoving) {
                updatePlayerMovement();
            } else {
                updatePlayerMovementKeyboard();
            }

            // Handle jumping
            handleJump();

            // Draw the player character
            drawPlayer();

            // Update animation
            player.animationCounter++;
            if (player.animationCounter >= 15) { // Slower animation
                player.walkingCycle = (player.walkingCycle + 1) % 2;
                player.animationCounter = 0;
            }

            requestAnimationFrame(gameLoop);
        }

        // Add mouse events for joystick
        canvas.addEventListener('mousedown', handleJoystickMovement);
        canvas.addEventListener('mousemove', handleJoystickMovement);
        canvas.addEventListener('mouseup', handleJoystickMovement);

        // Add mouse event for jump button
        canvas.addEventListener('mousedown', handleJumpButton);

        // Add keyboard event listeners for WASD movement
        document.addEventListener('keydown', (e) => {
            if (e.key === 'w') keys.w = true;
            if (e.key === 'a') keys.a = true;
            if (e.key === 's') keys.s = true;
            if (e.key === 'd') keys.d = true;
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'w') keys.w = false;
            if (e.key === 'a') keys.a = false;
            if (e.key === 's') keys.s = false;
            if (e.key === 'd') keys.d = false;
        });
    </script>
</body>
</html>
