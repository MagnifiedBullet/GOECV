<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isometric Joystick Game</title>
    <style>
        body {
            background-color: #1e1e2c;
            margin: 0;
            overflow: hidden;
            font-family: 'Comic Sans MS', cursive, sans-serif; /* Whimsical font */
        }
        canvas {
            display: block;
            margin: auto;
            background: url('https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/Background.PNG') no-repeat center center;
            background-size: cover;
        }
        h1 {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            color: white;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <h1>The Garden of Eeden</h1> <!-- Game title -->
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Player sprite sheet
        const playerImage = new Image();
        playerImage.src = 'https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/Characters/Red.png';

        // Joystick sprite sheet
        const joystickImage = new Image();
        joystickImage.src = 'https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/Joystick.png';

        // Jump button sprite sheet
        const jumpButtonImage = new Image();
        jumpButtonImage.src = 'https://raw.githubusercontent.com/MagnifiedBullet/GOECV/main/Assets/X-button.png';

        // Player properties
        const player = {
            x: 400,
            y: 300,
            width: 16,
            height: 30,
            speed: 2, // Movement speed
            direction: 'down',
            frameX: 0,
            frameY: 0,
            walkingCycle: 0,
            animationCounter: 0,
            velocityY: 0, // Y velocity for jumping
            isJumping: false
        };

        // Joystick properties
        const joystick = {
            x: 100, // Base position of the joystick
            y: canvas.height - 150,
            radius: 50, // Radius of the joystick base
            frameWidth: 128, // Width of each frame on the sprite sheet
            frameHeight: 128, // Height of each frame on the sprite sheet
            currentFrame: 0, // The frame corresponding to the current direction
            frames: {
                idle: { x: 0, y: 0 },       // Middle (idle)
                nw: { x: 1, y: 0 },         // NorthWest
                n: { x: 2, y: 0 },          // North
                ne: { x: 3, y: 0 },         // NorthEast
                e: { x: 4, y: 0 },          // East
                se: { x: 5, y: 0 },         // SouthEast
                s: { x: 6, y: 0 },          // South
                sw: { x: 7, y: 0 },         // SouthWest
                w: { x: 8, y: 0 }           // West
            }
        };

        // Jump button properties
        const jumpButton = {
            x: canvas.width - 120,
            y: canvas.height - 120,
            width: 100,
            height: 100,
            idleFrame: 0,
            pressedFrame: 1,
            currentFrame: 0
        };

        // Keyboard input flags
        const keys = {
            w: false,
            a: false,
            s: false,
            d: false
        };

        // Ensure all assets are loaded before starting the game
        let assetsLoaded = 0;

        function checkAssetsLoaded() {
            assetsLoaded++;
            if (assetsLoaded === 3) {
                gameLoop(); // Start the game loop once all assets are loaded
            }
        }

        joystickImage.onload = checkAssetsLoaded;
        playerImage.onload = checkAssetsLoaded;
        jumpButtonImage.onload = checkAssetsLoaded;

        // Draw the joystick (base + handle based on direction)
        function drawJoystick() {
            // Draw the joystick base (stationary)
            ctx.drawImage(joystickImage, 0, 0, 128, 128, joystick.x - joystick.radius, joystick.y - joystick.radius, joystick.radius * 2, joystick.radius * 2);

            // Draw the joystick handle (based on direction)
            const frame = Object.values(joystick.frames)[joystick.currentFrame];
            ctx.drawImage(
                joystickImage,
                frame.x * joystick.frameWidth, frame.y * joystick.frameHeight, // Source position in sprite sheet
                joystick.frameWidth, joystick.frameHeight, // Source size
                joystick.x - joystick.radius, joystick.y - joystick.radius, // Destination position
                joystick.radius * 2, joystick.radius * 2 // Destination size
            );
        }

        // Update joystick direction based on player movement
        function updateJoystickDirection() {
            if (keys.w && keys.a) joystick.currentFrame = 1; // NorthWest
            else if (keys.w && keys.d) joystick.currentFrame = 3; // NorthEast
            else if (keys.s && keys.a) joystick.currentFrame = 7; // SouthWest
            else if (keys.s && keys.d) joystick.currentFrame = 5; // SouthEast
            else if (keys.w) joystick.currentFrame = 2; // North
            else if (keys.s) joystick.currentFrame = 6; // South
            else if (keys.a) joystick.currentFrame = 8; // West
            else if (keys.d) joystick.currentFrame = 4; // East
            else joystick.currentFrame = 0; // Idle
        }

        // Update player movement based on WASD keyboard input
        function updatePlayerMovementKeyboard() {
            if (keys.w) player.y -= player.speed;
            if (keys.s) player.y += player.speed;
            if (keys.a) player.x -= player.speed;
            if (keys.d) player.x += player.speed;

            // Update joystick direction
            updateJoystickDirection();
        }

        // Draw the jump button
        function drawJumpButton() {
            ctx.drawImage(jumpButtonImage, jumpButton.currentFrame * 100, 0, 100, 100, jumpButton.x, jumpButton.y, jumpButton.width, jumpButton.height);
        }

        // Game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the joystick
            drawJoystick();

            // Draw the jump button
            drawJumpButton();

            // Update player movement based on keyboard input
            updatePlayerMovementKeyboard();

            // Draw player
            ctx.drawImage(
                playerImage,
                player.frameX * player.width,
                player.frameY * player.height,
                player.width,
                player.height,
                player.x,
                player.y,
                player.width,
                player.height
            );

            requestAnimationFrame(gameLoop);
        }

        // Handle keyboard input
        document.addEventListener('keydown', (e) => {
            if (e.key === 'w') keys.w = true;
            if (e.key === 'a') keys.a = true;
            if (e.key === 's') keys.s = true;
            if (e.key === 'd') keys.d = true;
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'w') keys.w = false;
            if (e.key === 'a') keys.a = false;
            if (e.key === 's') keys.s = false;
            if (e.key === 'd') keys.d = false;
        });
    </script>
</body>
</html>
